
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Iphone Hub - Tu Tienda de Tecnología</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
:root {
  --background-color: #ffffff;
  --surface-color: #ffffff;
  --primary-color: #007bff;
  --primary-glow: rgba(0, 123, 255, 0.25);
  --text-primary: #212529;
  --text-secondary: #6c757d;
  --border-color: rgba(0, 0, 0, 0.1);
}
body.dark-mode {
  --background-color: #000000;
  --surface-color: #2c2c2e;
  --text-primary: #f5f5f7;
  --text-secondary: #a1a1a6;
  --border-color: rgba(255, 255, 255, 0.15);
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }
body {
  font-family: 'Poppins', sans-serif;
  background-color: var(--background-color);
  color: var(--text-primary);
  transition: background-color 0.5s ease, color 0.5s ease;
}
#root { width: 100%; min-height: 100vh; }
.app-container { width: 100%; max-width: 1400px; margin: 0 auto; padding: 20px; }
@keyframes contentFadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
.app-header { display: flex; justify-content: space-between; align-items: center; padding: 20px 0; margin-bottom: 20px; border-bottom: 1px solid var(--border-color); }
.logo-container { display: flex; align-items: center; gap: 15px; color: var(--primary-color); }
.logo-icon { filter: drop-shadow(0 0 8px var(--primary-glow)); animation: rotate-logo 20s linear infinite; }
@keyframes rotate-logo { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
.app-title { font-family: 'Orbitron', sans-serif; font-size: 2.5rem; color: var(--primary-color); text-shadow: 0 0 10px var(--primary-glow); cursor: default; margin: 0; }
.header-actions { display: flex; align-items: center; gap: 15px; }
.whatsapp-header-btn { background: transparent; border: none; color: var(--text-secondary); cursor: pointer; padding: 8px; display: flex; align-items: center; justify-content: center; transition: color 0.3s ease; }
.shipping-header-btn { background: transparent; border: none; color: var(--text-secondary); cursor: pointer; padding: 8px; display: flex; align-items: center; justify-content: center; transition: color 0.3s ease; }
.shipping-header-btn:hover { color: var(--primary-color); }
.whatsapp-header-btn:hover { color: #25D366; }
.cart-button { position: relative; background: transparent; border: none; color: var(--text-secondary); cursor: pointer; transition: color 0.3s ease; padding: 8px; display: flex; align-items: center; justify-content: center; }
.cart-button:hover { color: var(--primary-color); }
.cart-badge { position: absolute; top: 0; right: 0; background-color: var(--primary-color); color: var(--background-color); width: 22px; height: 22px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 0.75rem; font-weight: 700; box-shadow: 0 0 10px var(--primary-glow); }
.category-selector { display: flex; justify-content: center; gap: 20px; margin-bottom: 40px; flex-wrap: wrap; }
.category-btn { background-color: transparent; color: var(--text-secondary); border: 2px solid var(--border-color); padding: 12px 24px; border-radius: 8px; font-size: 1rem; font-weight: 500; cursor: pointer; transition: all 0.3s ease; }
.category-btn:hover { color: var(--primary-color); border-color: var(--primary-color); }
.category-btn.active { background-color: var(--primary-color); color: #ffffff; border-color: var(--primary-color); box-shadow: 0 0 15px var(--primary-glow); }
.main-content { display: flex; flex-direction: column; }

/* --- Hero Video --- */
.hero-video-container {
  position: relative; /* Necesario para posicionar los videos hijos */
  margin-bottom: 40px;
  animation: contentFadeIn 0.8s ease-in-out;
  border-radius: 12px;
  overflow: hidden; /* Oculta las partes del video que se salgan del contenedor */
  height: 450px; /* Altura fija para evitar saltos de layout */
}
.hero-video { 
  position: absolute;
  top: 0;
  left: 0;
  width: 100%; 
  height: 100%; 
  object-fit: contain; 
  transition: opacity 0.8s ease-in-out; /* Transición suave */
}
#hero-video-2 {
  object-position: right; /* Alinea el video a la derecha */
}
#hero-video-3 {
  object-fit: cover; /* Hace que el video cubra todo el contenedor */
}

.category-section { width: 100%; animation: contentFadeIn 0.5s ease-in-out; }
.category-title { font-family: 'Orbitron', sans-serif; font-size: 2rem; margin-bottom: 30px; border-left: 4px solid var(--primary-color); padding-left: 15px; }
.product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 30px; }
.category-promo-message { background-color: #e6f2ff; border-left: 3px solid var(--primary-color); padding: 15px 20px; margin-bottom: 30px; border-radius: 0 8px 8px 0; font-size: 1rem; color: #004085; animation: contentFadeIn 0.5s; }
.new-badge { position: absolute; top: 15px; left: 15px; background-color: #28a745; color: white; padding: 5px 10px; border-radius: 5px; font-size: 0.8rem; font-weight: 700; z-index: 1; }
.product-card { background-color: var(--surface-color); border-radius: 12px; overflow: hidden; position: relative; padding: 20px; display: flex; flex-direction: column; transition: transform 0.3s ease, box-shadow 0.3s ease; border: 1px solid var(--border-color); }
.product-card:hover { transform: translateY(-8px); box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
.product-image { width: 100%; height: 250px; object-fit: contain; border-radius: 8px; margin-bottom: 20px; background-color: transparent; }
.product-info { flex-grow: 1; display: flex; flex-direction: column; }
.product-name { font-size: 1.4rem; font-weight: 700; margin-bottom: 10px; }
.product-description { font-size: 0.9rem; color: var(--text-secondary); line-height: 1.5; margin-bottom: 20px; flex-grow: 1; }
.product-footer { display: flex; justify-content: space-between; align-items: center; margin-top: auto; }
.color-selector { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px; justify-content: flex-start; }
.color-swatch { padding: 4px 12px; border: 1px solid var(--border-color); border-radius: 15px; cursor: pointer; font-size: 0.8rem; transition: all 0.3s ease; user-select: none; }
.color-swatch:hover { border-color: var(--primary-color); color: var(--primary-color); }
.color-swatch.selected { background-color: var(--primary-color); color: #ffffff; border-color: var(--primary-color); font-weight: 500; }

.color-swatch-circular {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    padding: 0;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    background-color: #E6E6FA; /* Lavanda */
}
/* Evitar que el color primario sobreescriba el color inicial del iPhone 17 */
.color-selector-dynamic .initial-color.selected {
    background-color: #E6E6FA; /* Lavanda */
    border-color: var(--primary-color); /* Mantenemos el borde para indicar selección */
}
.color-selector-dynamic .color-swatch:not(.initial-color) {
    opacity: 0;
    transform: scale(0.5);
    transition: opacity 0.4s ease, transform 0.4s ease;
    width: 0;
    padding: 0;
    margin-left: -10px; /* Para que no ocupen espacio al estar ocultos */
}
.color-selector-dynamic.expanded .color-swatch:not(.initial-color) {
    opacity: 1;
    transform: scale(1);
    width: 32px; /* Mismo tamaño que el circular */
    padding: 4px; /* Restaurar padding si es necesario */
    margin-left: 0;
}
/* Efecto de aparición escalonada */
.color-selector-dynamic.expanded .color-swatch:nth-child(2) { transition-delay: 0.1s; }
.color-selector-dynamic.expanded .color-swatch:nth-child(3) { transition-delay: 0.2s; }
.color-selector-dynamic.expanded .color-swatch:nth-child(4) { transition-delay: 0.3s; }
@keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.15); } 100% { transform: scale(1); } }
.initial-color.animating { animation: pulse 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94); }

.product-details-toggle { display: flex; align-items: center; justify-content: center; gap: 8px; color: var(--text-secondary); cursor: pointer; margin: 15px 0; font-size: 0.9rem; transition: color 0.3s ease; }
.product-details-toggle:hover { color: var(--primary-color); }
.product-details-toggle svg { transition: transform 0.3s ease; }
.product-card.expanded .product-details-toggle svg { transform: rotate(180deg); }
.product-details-content { max-height: 0; overflow: hidden; transition: max-height 0.5s ease-in-out, padding 0.5s ease-in-out; padding-top: 0; padding-bottom: 0; }
.product-card.expanded .product-details-content { max-height: 500px; /* Adjust as needed */ padding-top: 10px; padding-bottom: 10px; }
.details-list { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 12px; }
.details-list li { display: flex; flex-direction: column; }
.details-list strong { font-weight: 500; color: var(--text-primary); font-size: 0.9rem; margin-bottom: 4px; }
.details-list span { font-size: 0.85rem; color: var(--text-secondary); line-height: 1.4; }
.product-price { font-size: 1.5rem; font-weight: 700; color: var(--primary-color); }
.add-to-cart-btn { background-color: transparent; color: var(--primary-color); border: 2px solid var(--primary-color); padding: 10px 20px; border-radius: 8px; font-weight: 700; cursor: pointer; transition: background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease; }
.add-to-cart-btn:hover { background-color: var(--primary-color); color: #ffffff; box-shadow: 0 0 15px var(--primary-glow); }
.cart-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0s 0.3s linear; }
.cart-overlay.open { opacity: 1; visibility: visible; transition: opacity 0.3s ease; }

/* --- Product Detail View --- */
.product-detail-view { display: none; /* Oculto por defecto */ flex-direction: column; gap: 30px; animation: contentFadeIn 0.5s ease-in-out; }
.product-detail-view.visible { display: flex; }
.back-to-grid-btn { align-self: flex-start; background: none; border: 1px solid var(--border-color); color: var(--text-secondary); padding: 10px 20px; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 8px; margin-bottom: 20px; }
.back-to-grid-btn:hover { color: var(--primary-color); border-color: var(--primary-color); }
.product-detail-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; align-items: flex-start; }
.product-detail-image-gallery { display: flex; flex-direction: column; gap: 15px; background-color: var(--surface-color); border-radius: 12px; padding: 30px; border: 1px solid var(--border-color); }
.product-detail-main-image { width: 100%; max-height: 500px; object-fit: contain; border-radius: 8px; transition: opacity 0.3s ease; }
.product-detail-thumbnails { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }
.thumbnail-image-container { width: 60px; height: 60px; border-radius: 6px; border: 2px solid var(--border-color); cursor: pointer; transition: border-color 0.3s ease, transform 0.3s ease; overflow: hidden; }
.thumbnail-image-container:hover { border-color: var(--primary-color); transform: scale(1.05); }
.thumbnail-image-container.active { border-color: var(--primary-color); box-shadow: 0 0 10px var(--primary-glow); }
.thumbnail-image { width: 100%; height: 100%; object-fit: cover; }
.product-detail-info .product-name { font-size: 2.5rem; font-family: 'Orbitron', sans-serif; margin-bottom: 15px; }
.product-detail-info .product-description { font-size: 1rem; line-height: 1.6; margin-bottom: 25px; }
.product-detail-info .details-list { margin-top: 25px; border-top: 1px solid var(--border-color); padding-top: 25px; }
.product-detail-info .product-footer { margin-top: 30px; }

@media (max-width: 992px) {
  .product-detail-layout { grid-template-columns: 1fr; }
  .product-detail-info .product-name { font-size: 2rem; }
}
/* --- Tracking View --- */
.tracking-view { display: none; flex-direction: column; gap: 20px; animation: contentFadeIn 0.5s ease-in-out; max-width: 600px; margin: 0 auto; }
.tracking-view.visible { display: flex; }
.tracking-view h3 { font-family: 'Orbitron', sans-serif; font-size: 2rem; text-align: center; margin-bottom: 10px; }
.tracking-view .card-form { width: 100%; }
/* --- Timeline de Seguimiento --- */
.tracking-timeline { list-style: none; display: flex; flex-direction: column; position: relative; padding-left: 0; margin: 30px 0; }
.tracking-timeline::before { content: ''; position: absolute; top: 14px; bottom: 14px; left: 12px; width: 4px; background-color: #e9ecef; z-index: 1; border-radius: 2px; }
.timeline-progress { position: absolute; top: 14px; left: 12px; width: 4px; background-color: #28a745; z-index: 2; height: 0; border-radius: 2px; }
.timeline-step { position: relative; z-index: 3; display: flex; align-items: flex-start; margin-bottom: 30px; }
.timeline-step:last-child { margin-bottom: 0; }
.step-circle { width: 28px; height: 28px; border-radius: 50%; background-color: #e9ecef; border: 3px solid var(--background-color); display: flex; align-items: center; justify-content: center; transition: background-color 0.5s ease, border-color 0.5s ease; flex-shrink: 0; }
.step-circle svg { width: 16px; height: 16px; color: var(--text-secondary); }
.step-content { margin-left: 20px; padding-top: 3px; }
.step-label { font-size: 1rem; font-weight: 500; color: var(--text-secondary); }
.step-description { font-size: 0.85rem; color: var(--text-secondary); max-height: 0; overflow: hidden; transition: max-height 0.5s ease, margin-top 0.5s ease; }
/* Estilos para estados completados y activos */
.timeline-step.completed .step-circle, .timeline-step.active .step-circle { background-color: #28a745; border-color: #28a745; }
.timeline-step.completed .step-circle svg, .timeline-step.active .step-circle svg { color: white; }
.timeline-step.completed .step-label { color: var(--text-primary); font-weight: 500; }
.timeline-step.active .step-description, .timeline-step.completed .step-description { max-height: 40px; margin-top: 5px; }
@keyframes pulse-green { 0% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(40, 167, 69, 0); } 100% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0); } }
.timeline-step.active .step-circle { background-color: #28a745; border-color: #28a745; animation: pulse-green 2s infinite; }
.timeline-step.active .step-label { color: var(--text-primary); font-weight: 500; }
.tracking-status-message { text-align: center; font-size: 1.1rem; color: var(--text-primary); font-weight: 500; margin-top: 20px; }

/* --- Fin Product Detail View --- */

.cart-sidebar { position: fixed; top: 0; right: -450px; width: 450px; height: 100%; background-color: var(--surface-color); z-index: 1001; box-shadow: -10px 0 30px rgba(0, 0, 0, 0.3); transition: right 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); display: flex; flex-direction: column; border-left: 1px solid var(--border-color); }
.cart-sidebar.open { right: 0; }
.cart-header { display: flex; justify-content: space-between; align-items: center; padding: 20px; border-bottom: 1px solid var(--border-color); flex-shrink: 0; }
.cart-header h2 { font-family: 'Orbitron', sans-serif; font-size: 1.5rem; margin: 0; }
.close-cart-btn { background: none; border: none; font-size: 2.5rem; color: var(--text-secondary); cursor: pointer; line-height: 1; padding: 0; transition: color 0.3s ease, transform 0.3s ease; }
.close-cart-btn:hover { color: var(--primary-color); transform: rotate(90deg); }
.cart-items { flex-grow: 1; overflow-y: auto; padding: 20px; }
.empty-cart-message { text-align: center; color: var(--text-secondary); font-size: 1.1rem; padding-top: 40px; }
.cart-item { display: flex; gap: 15px; margin-bottom: 20px; position: relative; }
.cart-item-image { width: 80px; height: 80px; object-fit: contain; border-radius: 8px; flex-shrink: 0; }
.cart-item-details { flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; }
.cart-item-name { font-size: 1rem; font-weight: 500; margin: 0 0 5px; }
.cart-item-price { font-size: 0.9rem; color: var(--text-secondary); margin: 0; }
.cart-item-color { font-size: 0.85rem; color: var(--text-secondary); margin-top: 4px; }
.quantity-controls { display: flex; align-items: center; gap: 10px; margin-top: 10px; }
.quantity-controls button { background-color: #e9ecef; border: 1px solid var(--border-color); color: var(--text-primary); width: 28px; height: 28px; border-radius: 50%; cursor: pointer; font-size: 1rem; display: flex; justify-content: center; align-items: center; transition: background-color 0.3s ease, border-color 0.3s ease; }
.quantity-controls button:hover { background-color: var(--primary-color); border-color: var(--primary-color); color: #ffffff; }
.quantity-controls span { font-weight: 500; min-width: 20px; text-align: center; }
.remove-item-btn { position: absolute; top: 0; right: 0; background: none; border: none; color: var(--text-secondary); font-size: 1.5rem; cursor: pointer; line-height: 1; transition: color 0.3s ease, transform 0.3s ease; }
.remove-item-btn:hover { color: #ff4d4d; transform: scale(1.2); }
.cart-footer { padding: 20px; border-top: 1px solid var(--border-color); background-color: var(--surface-color); flex-shrink: 0; }
.discount-promo-message { background-color: #e6f2ff; border: 1px solid var(--border-color); border-radius: 8px; padding: 12px; margin-bottom: 20px; text-align: center; font-size: 0.9rem; color: #004085; }
.cart-summary-row { display: flex; justify-content: space-between; font-size: 1rem; color: var(--text-secondary); margin-bottom: 10px; }
.cart-summary-row.discount span:last-child { color: #4caf50; font-weight: 500; }
.cart-total { display: flex; justify-content: space-between; font-size: 1.2rem; font-weight: 700; margin-bottom: 20px; }
.cart-summary-row ~ .cart-total, .cart-total.with-discount { margin-top: 15px; padding-top: 15px; border-top: 1px dashed var(--border-color); }
.cart-total span:last-child { color: var(--primary-color); }
.checkout-btn { width: 100%; background-color: var(--primary-color); color: var(--background-color); border: none; padding: 15px; border-radius: 8px; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: background-color 0.3s ease, box-shadow 0.3s ease; }
.checkout-btn:hover { background-color: #0069d9; box-shadow: 0 0 20px var(--primary-glow); }
@keyframes modalFadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
.checkout-modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); z-index: 2000; display: flex; justify-content: center; align-items: center; }
.checkout-modal { background-color: var(--surface-color); border-radius: 12px; border: 1px solid var(--border-color); box-shadow: 0 10px 40px rgba(0,0,0,0.5); width: 90%; max-width: 500px; animation: modalFadeIn 0.3s cubic-bezier(0.165, 0.84, 0.44, 1); }
.checkout-modal-header { display: flex; justify-content: space-between; align-items: center; padding: 20px 25px; border-bottom: 1px solid var(--border-color); }
.checkout-modal-header h3 { font-family: 'Orbitron', sans-serif; font-size: 1.4rem; margin: 0; }
.checkout-modal-close-btn { background: none; border: none; font-size: 2rem; color: var(--text-secondary); cursor: pointer; line-height: 1; transition: color 0.3s ease, transform 0.3s ease; }
.checkout-modal-close-btn:hover { color: var(--primary-color); transform: rotate(90deg); }
.checkout-modal-body { padding: 25px; }
.checkout-total-display { background-color: var(--background-color); border-radius: 8px; padding: 15px 20px; margin-bottom: 25px; display: flex; justify-content: space-between; align-items: center; font-size: 1.1rem; }
.checkout-total-display strong { font-size: 1.5rem; color: var(--primary-color); font-weight: 700; }
.payment-options { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
.payment-option-btn { background-color: transparent; border: 2px solid var(--border-color); color: var(--text-secondary); padding: 20px; border-radius: 8px; font-size: 1rem; font-weight: 500; cursor: pointer; transition: all 0.3s ease; text-align: center; }
.payment-option-btn:hover { background-color: var(--primary-color); color: #ffffff; border-color: var(--primary-color); box-shadow: 0 0 15px var(--primary-glow); }
@keyframes confirmationFadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
.payment-confirmation-view { text-align: center; animation: confirmationFadeIn 0.4s ease-out; }
.card-payment-view { animation: confirmationFadeIn 0.4s ease-out; }
.card-form { display: flex; flex-direction: column; gap: 15px; }
.card-form .form-group { display: flex; flex-direction: column; }
.card-form label { font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 5px; }
.card-form input { background-color: var(--background-color); border: 1px solid var(--border-color); color: var(--text-primary); padding: 12px; border-radius: 6px; font-size: 1rem; }
.card-form .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
.card-form .submit-card-btn { background-color: var(--primary-color); color: #ffffff; border: none; padding: 15px; border-radius: 8px; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: background-color 0.3s ease, box-shadow 0.3s ease; margin-top: 10px; }
.card-form .submit-card-btn:hover { background-color: #0069d9; box-shadow: 0 0 20px var(--primary-glow); }
.card-form .submit-card-btn:disabled { background-color: #6c757d; cursor: not-allowed; }
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
.spinner { border: 2px solid rgba(255, 255, 255, 0.3); border-top-color: #fff; border-radius: 50%; width: 18px; height: 18px; animation: spin 1s linear infinite; }


.confirmation-text { color: var(--text-secondary); font-size: 1rem; line-height: 1.6; margin-bottom: 25px; }
.confirmation-text strong { color: var(--primary-color); font-weight: 500; }
.whatsapp-btn { width: 100%; background-color: #25D366; color: var(--text-primary); border: none; padding: 15px; border-radius: 8px; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: background-color 0.3s ease, box-shadow 0.3s ease; margin-bottom: 15px; display: flex; justify-content: center; align-items: center; gap: 10px; }
.whatsapp-btn:hover { background-color: #128C7E; box-shadow: 0 0 20px rgba(37, 211, 102, 0.5); }
.back-btn { background: none; border: none; color: var(--text-secondary); cursor: pointer; font-size: 0.9rem; font-weight: 500; transition: color 0.3s ease; }
.back-btn:hover { color: var(--primary-color); text-decoration: underline; }
.app-footer { text-align: center; padding: 40px 20px; margin-top: 40px; border-top: 1px solid var(--border-color); color: var(--text-secondary); }
.app-footer p { margin: 0; display: flex; justify-content: center; align-items: center; gap: 10px; }
.app-footer a { color: var(--primary-color); text-decoration: none; transition: text-decoration 0.3s ease, color 0.3s ease; font-weight: 500; }
.app-footer a:hover { text-decoration: underline; color: #00bfff; }
.app-footer svg { width: 20px; height: 20px; stroke: var(--text-secondary); transition: stroke 0.3s ease; }
.app-footer p:hover svg { stroke: var(--primary-color); }

/* --- MEDIA QUERIES --- */
@media (max-width: 768px) {
  .app-title { font-size: 2rem; }
  .logo-icon { width: 40px; height: 40px; }
  .category-btn { padding: 10px 20px; font-size: 0.9rem; }
  .category-title { font-size: 1.8rem; }
  .product-grid { gap: 20px; }
  .product-name { font-size: 1.2rem; }
  .product-price { font-size: 1.3rem; }
}
@media (max-width: 480px) {
  .app-container { padding: 15px; }
  .logo-container { gap: 10px; }
  .logo-icon { width: 32px; height: 32px; }
  .app-title { font-size: 1.8rem; }
  .header-actions { gap: 5px; }
  .category-selector { gap: 10px; }
  .category-btn { padding: 8px 12px; font-size: 0.8rem; width: calc(33.333% - 10px); text-align: center; }
  .main-content { gap: 40px; }
  .category-title { font-size: 1.5rem; margin-bottom: 20px; }
  .product-grid { 
    grid-template-columns: repeat(3, 1fr); /* Mostrar 3 columnas en móvil */
    gap: 10px; 
  }
  .product-image { height: 120px; margin-bottom: 10px; } /* Imagen más pequeña */
  .product-name { font-size: 0.9rem; margin-bottom: 5px; } /* Nombre más pequeño */
  .product-description { display: none; } /* Ocultar descripción */
  .product-footer { flex-direction: column; align-items: flex-start; gap: 8px; } /* Apilar precio y botón */
  .product-price { font-size: 1.1rem; } /* Precio más pequeño */
  .add-to-cart-btn { padding: 6px 10px; font-size: 0.8rem; width: 100%; text-align: center; } /* Botón más pequeño y ancho completo */
  .product-card { padding: 10px; }

  .cart-sidebar { width: 100vw; right: -100vw; }
  .payment-options { grid-template-columns: 1fr; }
  .payment-option-btn { padding: 15px; }
  .card-form .form-row { grid-template-columns: 1fr; } /* Stack expiry and CVC vertically */
}
/* --- Notification --- */
.notification {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%) translateY(100px); /* Start off-screen */
  background-color: #28a745; /* Green for success */
  color: white;
  padding: 12px 25px;
  border-radius: 8px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  z-index: 3000;
  font-weight: 500;
  opacity: 0;
  visibility: hidden;
  transition: transform 0.4s cubic-bezier(0.215, 0.610, 0.355, 1), opacity 0.4s ease;
  white-space: nowrap;
}
.notification.show {
  transform: translateX(-50%) translateY(0);
  opacity: 1;
  visibility: visible;
}
    </style>
</head>
<body>
    <div id="root">
        <div class="app-container">
            <header class="app-header">
                <div class="logo-container">
                    <svg class="logo-icon" width="48" height="48" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="32" cy="32" r="14" stroke="currentColor" stroke-width="3"></circle>
                        <ellipse cx="32" cy="32" rx="28" ry="10" stroke="currentColor" stroke-width="3"></ellipse>
                    </svg>
                    <h1 class="app-title">Iphone Hub</h1>
                </div>
                <div class="header-actions">
                    <button id="whatsapp-header-btn" class="whatsapp-header-btn" aria-label="Contáctanos en WhatsApp">
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="currentColor"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.894 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01s-.521.074-.792.372c-.272.296-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.203 5.076 4.487.709.306 1.262.489 1.694.626.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"/></svg>
                    </button>
                    <button id="shipping-header-btn" class="shipping-header-btn" aria-label="Información de Envíos">
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h15v13H2z"/><path d="M16 8h4l3 3v5h-7V8z"/><circle cx="5.5" cy="18.5" r="2.5"/><circle cx="18.5" cy="18.5" r="2.5"/></svg>
                    </button>
                    <button class="cart-button" id="cart-button" aria-label="Abrir carrito de compras">
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
                        <span class="cart-badge" id="cart-badge" style="display: none;">0</span>
                    </button>
                </div>
            </header>
            <section class="hero-video-container">
                <video id="hero-video-1" class="hero-video" src="https://www.apple.com/105/media/us/iphone-17/2025/b2c72de3-1cbc-4e24-b4d3-23c7abcec4ec/anim/hero/large.mp4" autoplay muted playsinline style="opacity: 1;"></video>
                <video id="hero-video-2" class="hero-video" src="https://www.apple.com/105/media/us/iphone-air/2025/731189b1-a606-493f-afa4-7c766a8fd08d/anim/hero/large.mp4" muted playsinline style="opacity: 0;"></video>
            </section>
            <nav id="category-selector" class="category-selector"></nav>
            <main class="main-content">
                <section id="category-section" class="category-section">
                    <h2 class="category-title" id="category-title"></h2>
                    <div id="category-promo-message" class="category-promo-message" style="display: none;"></div>
                    <div class="product-grid" id="product-grid"></div>
                </section>
                <section id="product-detail-view" class="product-detail-view">
                    <!-- El contenido se generará dinámicamente con JS -->
                </section>
                <section id="tracking-view" class="tracking-view">
                    <!-- El contenido se generará dinámicamente con JS -->
                </section>
            </main>
            <footer class="app-footer">
                <p> 
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                    <span>Contacto:</span>
                    <a href="mailto:applesuporr@gmail.com">applesuporr@gmail.com</a>
                </p>
            </main>
        </div>
        <div id="cart-overlay" class="cart-overlay"></div>
        <aside id="cart-sidebar" class="cart-sidebar">
            <div class="cart-header">
                <h2>Tu Carrito</h2>
                <button id="close-cart-btn" class="close-cart-btn">&times;</button>
            </div>
            <div id="cart-items" class="cart-items"></div>
            <div id="cart-footer" class="cart-footer" style="display: none;"></div>
        </aside>
        <div id="checkout-modal-overlay" class="checkout-modal-overlay" style="display: none;">
            <div id="checkout-modal" class="checkout-modal">
                <div class="checkout-modal-header">
                    <h3 id="modal-title">Selecciona un Método de Pago</h3>
                    <button id="checkout-modal-close-btn" class="checkout-modal-close-btn">&times;</button>
                </div>
                <div class="checkout-modal-body">
                    <div class="checkout-total-display">
                        <span>Monto Total</span>
                        <strong id="checkout-total">$0.00</strong>
                    </div>
                    <div id="payment-options" class="payment-options">
                        <button class="payment-option-btn">TRC20</button>
                        <button class="payment-option-btn">USDT</button>
                        <button class="payment-option-btn">Bitcoin</button>
                        <button class="payment-option-btn">Tarjeta</button>
                    </div>
                    <div id="card-payment-view" class="card-payment-view" style="display: none;">
                        <form id="card-form" class="card-form">
                            <div class="form-group">
                                <label for="card-number">Número de Tarjeta</label>
                                <input type="text" id="card-number" name="card-number" placeholder="•••• •••• •••• ••••" required>
                            </div>
                            <div class="form-group">
                                <label for="card-name">Nombre del Titular</label>
                                <input type="text" id="card-name" name="card-name" placeholder="John M. Doe" required>
                            </div>
                            <div class="form-row">
                                <input type="text" id="card-expiry" name="card-expiry" placeholder="MM/AA" required>
                                <input type="text" id="card-cvc" name="card-cvc" placeholder="CVC" required maxlength="3">
                            </div>
                            <div class="form-group">
                                <label for="card-document-number">Número de Documento (DNI, etc.)</label>
                                <input type="text" id="card-document-number" name="card-document-number" placeholder="Ingresa tu número de documento" required>
                            </div>
                            <button type="submit" class="submit-card-btn">
                                <span class="btn-text">Confirmar Datos de Pago</span>
                                <span class="spinner" style="display: none;"></span>
                            </button>
                        </form>
                        <button id="back-btn-card" class="back-btn" style="margin-top: 15px;">&larr; Elegir otro método</button>
                    </div>
                    <div id="payment-confirmation-view" class="payment-confirmation-view" style="display: none;">
                        <p id="confirmation-text" class="confirmation-text"></p>
                        <button id="whatsapp-pay-btn" class="whatsapp-btn">Pagar con WhatsApp</button>
                        <button id="back-btn" class="back-btn">&larr; Elegir otro método</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="notification" class="notification"></div>
    </div>
    <script>
        // Los datos de products.json ahora están incrustados directamente aquí
        const productsData = {
            "iphones": {
                "title": "iPhones",
                "data": [
                    { 
                        "id": 34, 
                        "name": "iPhone 17", 
                        "description": "El futuro es ahora. Con el chip A19 Fusion, una pantalla ProMotion sin bordes y capacidades de IA revolucionarias.", 
                        "price": "$1199",
                        "isNew": true,
                        "imageUrls": ["https://www.apple.com/la/iphone-17/images/overview/product-viewer/initial__dplc9g66mywm_large.webp"], 
                        "colors": ["Rosa", "Salvia", "Azul Neblina", "Blanco", "Negro"],
                        "colorImages": {
                            "Rosa": "https://www.apple.com/v/iphone-17/b/images/overview/product-viewer/colors_lavender__d1q01bi7ck6e_large.jpg",
                            "Salvia": "https://www.apple.com/v/iphone-17/b/images/overview/product-viewer/colors_sage__euyhc08cz3sm_large.jpg",
                            "Azul Neblina": "https://www.apple.com/v/iphone-17/b/images/overview/product-viewer/colors_mist_blue__bykduvce5336_large.jpg",
                            "Blanco": "https://www.apple.com/v/iphone-17/b/images/overview/product-viewer/colors_white__xeu5egr194y6_large.jpg",
                            "Negro": "https://www.apple.com/v/iphone-17/b/images/overview/product-viewer/colors_black__dkowmaeljgya_large.jpg"
                        },
                        "details": { "camera": "Sistema de triple cámara de 64MP con lente periscópica y grabación 8K.", "screen": "Pantalla Super Retina XDR de 6.3\" sin bordes, 2000 nits, ProMotion 144Hz.", "specs": "Chip A19 Fusion con Neural Engine de 5ª generación.", "battery": "Hasta 30 horas de reproducción de video.", "sim": "Solo eSIM.", "connectivity": "5G Advanced, Wi-Fi 7, USB-C con Thunderbolt 4." } 
                    },
                    { "id": 1, "name": "iPhone 15 Pro", "description": "Chip A17 Pro. Sistema de cámaras Pro. Diseño de titanio. La experiencia iPhone definitiva.", "price": "$999", "imageUrls": ["https://entel.cdn.modyo.com/uploads/0050a0ad-3320-4a60-b52f-3a6c8af00200/original/apple-iphone-15-pro-natural-2.png", "https://entel.cdn.modyo.com/uploads/e0cb8b9c-2e10-4f1c-ab62-a38110d53124/original/apple-iphone-15-pro-natural-1.png"], "colors": ["Titanio"], "details": { "camera": "Sistema de cámaras Pro (48MP principal, 12MP ultra gran angular, 12MP teleobjetivo 2x y 3x), modo Cine 4K HDR Dolby Vision, grabación de video ProRes.", "screen": "Super Retina XDR de 6.1\", ProMotion con tasa de refresco adaptativa de hasta 120Hz, Dynamic Island.", "specs": "Chip A17 Pro, CPU de 6 núcleos, GPU de 6 núcleos, Neural Engine de 16 núcleos.", "battery": "Hasta 23 horas de reproducción de video. Carga rápida y MagSafe.", "sim": "Dual SIM (nano-SIM y eSIM). Compatible con doble eSIM.", "connectivity": "5G, Wi-Fi 6E, Bluetooth 5.3, USB-C con velocidades de USB 3." } },
                    { "id": 2, "name": "iPhone 15", "description": "Dynamic Island. Chip A16 Bionic. Un impresionante sistema de doble cámara. Todo en un diseño duradero.", "price": "$799", "imageUrls": ["https://tienda.claro.com.ar/staticContent/Claro/images/catalog/productos/646x1000/70012268_3.webp", "https://tienda.claro.com.ar/staticContent/Claro/images/catalog/productos/646x1000/70012268_2.webp"], "colors": ["Negro"], "details": { "camera": "Sistema de doble cámara (48MP principal, 12MP ultra gran angular), modo Cine 4K HDR, Photonic Engine.", "screen": "Super Retina XDR de 6.1\", Dynamic Island, brillo máximo de 2000 nits.", "specs": "Chip A16 Bionic, CPU de 6 núcleos, GPU de 5 núcleos.", "battery": "Hasta 20 horas de reproducción de video.", "sim": "Dual SIM (nano-SIM y eSIM).", "connectivity": "5G, Wi-Fi 6, Bluetooth 5.3, USB-C." } },
                    { "id": 10, "name": "iPhone 14 Pro", "description": "Dynamic Island, pantalla siempre activa y el potente chip A16 Bionic. Un gran salto para el iPhone.", "price": "$899", "imageUrls": ["https://laplatacells.com.ar/img/Public/1169/62057-producto-iphone-14-pro-space-black-pdp-image-position-1a-mxla.jpg", "https://m.media-amazon.com/images/I/51dv1fGXSpL._AC_SX679_.jpg"], "colors": ["Negro"], "details": { "camera": "Sistema de cámaras Pro (48MP principal, 12MP ultra gran angular, 12MP teleobjetivo), modo Cine 4K.", "screen": "Super Retina XDR de 6.1\", ProMotion, Dynamic Island, Pantalla siempre activa.", "specs": "Chip A16 Bionic, CPU de 6 núcleos, GPU de 5 núcleos.", "battery": "Hasta 23 horas de reproducción de video.", "sim": "Dual SIM (nano-SIM y eSIM).", "connectivity": "5G, Wi-Fi 6, Bluetooth 5.3, Conector Lightning." } },
                    { "id": 11, "name": "iPhone 14", "description": "Funciones de seguridad vitales, un diseño duradero y un sistema de doble cámara mejorado para fotos impresionantes.", "price": "$699", "imageUrls": ["https://tienda.personal.com.ar/images/720/webp/Specs_i_Phone_14_Midnight_de0fde1fa7.png", "https://tienda.personal.com.ar/images/720/webp/Specs_i_Phone_14_Midnight_28006c8c01.png"], "colors": ["Negro", "Blanco"], "colorImages": {
                            "Negro": "https://tienda.personal.com.ar/images/720/webp/Specs_i_Phone_14_Midnight_de0fde1fa7.png",
                            "Blanco": "https://images.fravega.com/f300/c26eb14dbcbae87306c6e7ad7c7ff0b2.jpg.webp"
                        }, "details": { "camera": "Sistema de doble cámara de 12MP (principal y ultra gran angular), Photonic Engine.", "screen": "Super Retina XDR de 6.1\", True Tone.", "specs": "Chip A15 Bionic, CPU de 6 núcleos, GPU de 5 núcleos.", "battery": "Hasta 20 horas de reproducción de video.", "sim": "Dual SIM (nano-SIM y eSIM).", "connectivity": "5G, Wi-Fi 6, Bluetooth 5.3, Conector Lightning." } },
                    { "id": 12, "name": "iPhone 13", "description": "Chip A15 Bionic, pantalla súper brillante y un gran salto en la duración de la batería. Un iPhone muy potente.", "price": "$599", "imageUrls": ["https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/iphone-13-finish-select-202207-6-1inch-pink?wid=2560&hei=1440&fmt=p-jpg&qlt=80&.v=1656712888451", "https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/iphone-13-finish-select-202207-6-1inch-blue?wid=2560&hei=1440&fmt=p-jpg&qlt=80&.v=1656712888128", "https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/iphone-13-finish-select-202207-6-1inch-product-red?wid=2560&hei=1440&fmt=p-jpg&qlt=80&.v=1656712889929"], "colors": ["Rosado", "Azul", "Rojo"], "colorImages": {
                            "Rosado": "https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/iphone-13-finish-select-202207-6-1inch-pink?wid=2560&hei=1440&fmt=p-jpg&qlt=80&.v=1656712888451",
                            "Azul": "https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/iphone-13-finish-select-202207-6-1inch-blue?wid=2560&hei=1440&fmt=p-jpg&qlt=80&.v=1656712888128",
                            "Rojo": "https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/iphone-13-finish-select-202207-6-1inch-product-red?wid=2560&hei=1440&fmt=p-jpg&qlt=80&.v=1656712889929"
                        }, "details": { "camera": "Sistema de doble cámara de 12MP (principal y ultra gran angular), Estilos Fotográficos, modo Cine.", "screen": "Super Retina XDR de 6.1\", Ceramic Shield.", "specs": "Chip A15 Bionic, CPU de 6 núcleos, GPU de 4 núcleos.", "battery": "Hasta 19 horas de reproducción de video.", "sim": "Dual SIM (nano-SIM y eSIM).", "connectivity": "5G, Wi-Fi 6, Bluetooth 5.0, Conector Lightning." } },
                    { "id": 3, "name": "iPhone SE", "description": "Potencia seria con el chip A15 Bionic. Diseño compacto. Una gran entrada al ecosistema de Apple.", "price": "$429", "imageUrls": ["https://www.apple.com/newsroom/images/product/iphone/standard/Apple_new-iphone-se-white_04152020_big.jpg.small_2x.jpg"], "colors": ["Blanco Estelar"], "details": { "camera": "Cámara gran angular de 12MP, HDR Inteligente 4, modo Retrato.", "screen": "Pantalla Retina HD de 4.7\", True Tone.", "specs": "Chip A15 Bionic, CPU de 6 núcleos, GPU de 4 núcleos.", "battery": "Hasta 15 horas de reproducción de video.", "sim": "Dual SIM (nano-SIM y eSIM).", "connectivity": "5G, Wi-Fi 6, Bluetooth 5.0, Conector Lightning." } },
                    { "id": 13, "name": "iPhone 12", "description": "A14 Bionic, el chip más rápido en un smartphone. Una pantalla OLED de borde a borde. Ceramic Shield.", "price": "$499", "imageUrls": ["https://www.apple.com/newsroom/images/product/iphone/geo/apple_iphone-12_2-up_geo_10132020_inline.jpg.small_2x.jpg"], "colors": ["Azul"], "details": { "camera": "Sistema de doble cámara de 12MP (principal y ultra gran angular), modo Noche.", "screen": "Super Retina XDR de 6.1\", Ceramic Shield.", "specs": "Chip A14 Bionic con Neural Engine de 16 núcleos.", "battery": "Hasta 17 horas de reproducción de video.", "sim": "Dual SIM (nano-SIM y eSIM).", "connectivity": "5G, Wi-Fi 6, Bluetooth 5.0, Conector Lightning." } },
                    { "id": 14, "name": "iPhone 11", "description": "Sistema de doble cámara, modo Noche y el chip A13 Bionic. Un iPhone de gran valor.", "price": "$399", "imageUrls": ["https://m.media-amazon.com/images/I/71vIhOeEIdL._AC_UF894,1000_QL80_FMwebp_.jpg"], "colors": ["Blanco"], "details": { "camera": "Sistema de doble cámara de 12MP (principal y ultra gran angular), modo Noche.", "screen": "Pantalla Liquid Retina HD de 6.1\".", "specs": "Chip A13 Bionic con Neural Engine de 8 núcleos.", "battery": "Hasta 17 horas de reproducción de video.", "sim": "Dual SIM (nano-SIM y eSIM).", "connectivity": "4G LTE Advanced, Wi-Fi 6, Bluetooth 5.0, Conector Lightning." } },
                    { "id": 15, "name": "iPhone XR", "description": "Pantalla Liquid Retina, Face ID y un potente chip A12 Bionic. Brillante en todos los sentidos.", "price": "$299", "imageUrls": ["https://www.apple.com/newsroom/images/product/iphone/standard/iPhone_XR_white-back_09122018_carousel.jpg.small_2x.jpg"], "colors": ["Coral"], "details": { "camera": "Cámara de 12MP (gran angular), modo Retrato, Control de Profundidad.", "screen": "Pantalla Liquid Retina HD de 6.1\".", "specs": "Chip A12 Bionic con Neural Engine de 2ª generación.", "battery": "Hasta 16 horas de reproducción de video.", "sim": "Dual SIM (nano-SIM y eSIM).", "connectivity": "4G LTE, Wi-Fi 5, Bluetooth 5.0, Conector Lightning." } },
                    { "id": 16, "name": "iPhone 8", "description": "Diseño de vidrio, pantalla Retina HD y el chip A11 Bionic. Un diseño clásico con potencia moderna.", "price": "$199", "imageUrls": ["https://www.apple.com/newsroom/images/product/iphone/standard/8plus_and_8_glass_back_big.jpg.small_2x.jpg"], "colors": ["Rosa"], "details": { "camera": "Cámara de 12MP, grabación de video 4K.", "screen": "Pantalla Retina HD de 4.7\", Touch ID.", "specs": "Chip A11 Bionic con Neural Engine.", "battery": "Hasta 13 horas de reproducción de video.", "sim": "Una nano-SIM.", "connectivity": "4G LTE, Wi-Fi 5 (802.11ac), Bluetooth 5.0, Conector Lightning." } },
                    { "id": 17, "name": "iPhone 7", "description": "Un sistema de cámara avanzado, el mejor rendimiento y duración de batería en un iPhone, y altavoces estéreo.", "price": "$149", "imageUrls": ["https://wefix.co.za/cdn/shop/products/iphone-7-Rose-gold_2_48ef5f00-a2b9-40e5-b6fc-31ce0da1450e.png?v=1639151496&width=1900"], "colors": ["Rosa"], "details": { "camera": "Cámara de 12MP, estabilización óptica de imagen.", "screen": "Pantalla Retina HD de 4.7\", Touch ID.", "specs": "Chip A10 Fusion.", "battery": "Hasta 13 horas de reproducción de video.", "sim": "Una nano-SIM.", "connectivity": "4G LTE, Wi-Fi 5 (802.11ac), Bluetooth 4.2, Conector Lightning." } }
                ]
            },
            "iphones-b-stock": {
                "title": "iPhones (50% Descuento)",
                "data": [
                    { "id": 18, "name": "iPhone 14 (Falla de Fábrica)", "description": "Nota: Esta unidad tiene un defecto cosmético menor en la carcasa, pero es completamente funcional. Se vende con un 50% de descuento. Incluye funciones de seguridad vitales y un sistema de doble cámara mejorado.", "price": "$349.50", "imageUrls": ["https://cdn-ipoint.waugi.com.ar/25214-large_default/iphone-14-256gb-midnight.jpg"], "colors": ["Medianoche"], "details": { "camera": "Sistema de doble cámara de 12MP (principal y ultra gran angular), Photonic Engine.", "screen": "Super Retina XDR de 6.1\", True Tone.", "specs": "Chip A15 Bionic, CPU de 6 núcleos, GPU de 5 núcleos.", "battery": "Hasta 20 horas de reproducción de video.", "sim": "Dual SIM (nano-SIM y eSIM).", "connectivity": "5G, Wi-Fi 6, Bluetooth 5.3, Conector Lightning." } },
                    { "id": 19, "name": "iPhone 13 (Falla de Fábrica)", "description": "Nota: Esta unidad tiene una pequeña anomalía de píxeles en el borde de la pantalla, pero es completamente funcional. Se vende con un 50% de descuento. Cuenta con el chip A15 Bionic y una pantalla súper brillante.", "price": "$299.50", "imageUrls": ["https://www.apple.com/newsroom/images/product/iphone/geo/Apple_iphone13_hero_geo_09142021_inline.jpg.small_2x.jpg"], "colors": ["Rosa"], "details": { "camera": "Sistema de doble cámara de 12MP (principal y ultra gran angular), Estilos Fotográficos, modo Cine.", "screen": "Super Retina XDR de 6.1\", Ceramic Shield.", "specs": "Chip A15 Bionic, CPU de 6 núcleos, GPU de 4 núcleos.", "battery": "Hasta 19 horas de reproducción de video.", "sim": "Dual SIM (nano-SIM y eSIM).", "connectivity": "5G, Wi-Fi 6, Bluetooth 5.0, Conector Lightning." } },
                    { "id": 20, "name": "iPhone 12 (Falla de Fábrica)", "description": "Nota: Esta unidad tiene un rasguño menor en el cristal trasero, pero es completamente funcional. Se vende con un 50% de descuento. Cuenta con el chip A14 Bionic y una pantalla OLED de borde a borde.", "price": "$249.50", "imageUrls": ["https://www.apple.com/newsroom/images/product/iphone/geo/apple_iphone-12_2-up_geo_10132020_inline.jpg.small_2x.jpg"], "colors": ["Azul"], "details": { "camera": "Sistema de doble cámara de 12MP (principal y ultra gran angular), modo Noche.", "screen": "Super Retina XDR de 6.1\", Ceramic Shield.", "specs": "Chip A14 Bionic.", "battery": "Hasta 17 horas de reproducción de video.", "sim": "Dual SIM (nano-SIM y eSIM).", "connectivity": "5G, Wi-Fi 6, Bluetooth 5.0, Conector Lightning." } },
                    { "id": 21, "name": "iPhone 11 (Falla de Fábrica)", "description": "Nota: Esta unidad tiene una ligera decoloración en el marco, pero es completamente funcional. Se vende con un 50% de descuento. Cuenta con un sistema de doble cámara con modo Noche y el chip A13 Bionic.", "price": "$199.50", "imageUrls": ["https://m.media-amazon.com/images/I/71vIhOeEIdL._AC_UF894,1000_QL80_FMwebp_.jpg"], "colors": ["Blanco"], "details": { "camera": "Sistema de doble cámara de 12MP (principal y ultra gran angular), modo Noche.", "screen": "Pantalla Liquid Retina HD de 6.1\".", "specs": "Chip A13 Bionic.", "battery": "Hasta 17 horas de reproducción de video.", "sim": "Dual SIM (nano-SIM y eSIM).", "connectivity": "4G LTE Advanced, Wi-Fi 6, Bluetooth 5.0, Conector Lightning." } }
                ]
            },
            "gaming-pcs": {
                "title": "PCs Gamer",
                "data": [
                    { "id": 4, "name": "CyberPower Xtreme", "description": "Intel Core i9, NVIDIA RTX 4090, 32GB RAM DDR5, 2TB SSD NVMe. Desata el dominio puro en los juegos.", "price": "$3,499", "imageUrls": ["https://m.media-amazon.com/images/I/71K4CkU04bL._AC_UF1000,1000_QL80_FMwebp_.jpg"], "colors": ["Negro"], "details": { "CPU": "Intel Core i9 (última generación)", "GPU": "NVIDIA GeForce RTX 4090 24GB GDDR6X", "RAM": "32GB DDR5 a 5600MHz", "Almacenamiento": "2TB NVMe PCIe Gen4 SSD", "Sistema Operativo": "Windows 11 Home" } },
                    { "id": 5, "name": "iBUYPOWER Pro", "description": "AMD Ryzen 7, NVIDIA RTX 4070, 16GB RAM DDR5, 1TB SSD NVMe. Rendimiento de gama alta por menos.", "price": "$1,899", "imageUrls": ["https://m.media-amazon.com/images/I/7128GOUxSCL._AC_SL1500_.jpg"], "colors": ["Negro", "Blanco"], "details": { "CPU": "AMD Ryzen 7 (serie 7000)", "GPU": "NVIDIA GeForce RTX 4070 12GB GDDR6X", "RAM": "16GB DDR5 a 5200MHz", "Almacenamiento": "1TB NVMe PCIe Gen4 SSD", "Sistema Operativo": "Windows 11 Home" } },
                    { "id": 6, "name": "Alienware Aurora R16", "description": "El diseño futurista se une a la potencia de última generación. Intel Core i7, RTX 4060, 16GB de RAM para una experiencia premium.", "price": "$1,599", "imageUrls": ["https://m.media-amazon.com/images/I/71C+ewM2JjL._AC_SL1500_.jpg"], "colors": ["Blanco Lunar", "Negro Cósmico"], "details": { "CPU": "Intel Core i7 (última generación)", "GPU": "NVIDIA GeForce RTX 4060 8GB GDDR6", "RAM": "16GB DDR5 a 5600MHz", "Almacenamiento": "1TB NVMe PCIe Gen4 SSD", "Sistema Operativo": "Windows 11 Home" } }
                ]
            },
            "accessories": {
                "title": "Accesorios",
                "data": [
                    { "id": 7, "name": "Spigen Tempered Glass", "description": "Protector de pantalla de dureza 9H con revestimiento oleofóbico. Transparente y fácil de instalar.", "price": "$15.99", "imageUrls": ["https://www.spigen.com/cdn/shop/products/title_web_ip6.7p_ezfitsp_01.jpg?v=1695081006&width=990"], "colors": ["Transparente"], "details": { "Compatibilidad": "Compatible con la mayoría de los modelos de iPhone (verificar modelo específico).", "Material": "Vidrio templado de alta calidad.", "Dureza": "9H para resistencia a arañazos.", "Características": "Revestimiento oleofóbico, aplicador EZ Fit para instalación fácil." } },
                    { "id": 8, "name": "ESR Armorite Glass", "description": "Protección de pantalla ultrarresistente clasificada para soportar más de 50 kg de fuerza. Para una protección seria.", "price": "$24.99", "imageUrls": ["https://www.spigen.com/cdn/shop/products/detail_web_ip6.7p_ezfitsp_02.jpg?v=1695081014&width=990"], "colors": ["Transparente"], "details": { "Compatibilidad": "Diseñado para modelos específicos de iPhone (verificar modelo).", "Material": "Vidrio Armorite ultra resistente.", "Resistencia": "Soporta hasta 50 kg de fuerza, alta resistencia a impactos.", "Características": "Claridad HD, incluye kit de limpieza y marco de alineación." } },
                    { "id": 9, "name": "ZAGG InvisibleShield", "description": "Protección avanzada contra roturas con tecnología antibacteriana. Cobertura de borde a borde.", "price": "$49.99", "imageUrls": ["https://images.mironet.cz/foto/w3/96099873/1.jpg.add.webp"], "colors": ["Transparente con Borde Negro"], "details": { "Compatibilidad": "Disponible para una amplia gama de smartphones.", "Tecnología": "Glass XTR3 con filtro de luz azul y tratamiento antirreflejos.", "Protección": "Tecnología D3O® para dispersión de impactos.", "Características": "Tratamiento antibacteriano, sensibilidad táctil mejorada." } },
                    { "id": 30, "name": "Adaptador de Corriente USB-C de 20W", "description": "El adaptador de corriente USB-C de 20W de Apple ofrece una carga rápida y eficiente en casa, en la oficina o donde estés.", "price": "$19", "imageUrls": ["https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/MU7T2_AV2?wid=1144&hei=1144&fmt=jpeg&qlt=90&.v=1693248282092"], "colors": ["Blanco"], "details": { "Compatibilidad": "iPhone, iPad, Apple Watch", "Potencia": "20W", "Conector": "USB-C", "Características": "Carga rápida, diseño compacto." } },
                    { "id": 31, "name": "Cargador Anker 735 (GaNPrime 65W)", "description": "Carga 3 dispositivos a la vez con 2 puertos USB-C y 1 puerto USB-A. Potencia total de 65W con tecnología GaN para un tamaño reducido.", "price": "$59.99", "imageUrls": ["https://http2.mlstatic.com/D_NQ_NP_2X_775609-CBT82249628552_022025-F.webp"], "colors": ["Negro", "Blanco"], "details": { "Potencia Total": "65W", "Puertos": "2 USB-C, 1 USB-A", "Tecnología": "GaNPrime, PowerIQ 4.0", "Características": "Carga simultánea de 3 dispositivos, distribución dinámica de energía." } },
                    { "id": 32, "name": "Cargador MagSafe", "description": "El cargador MagSafe hace que la carga inalámbrica sea muy sencilla. Los imanes perfectamente alineados se acoplan a tu iPhone para proporcionar una carga inalámbrica más rápida de hasta 15W.", "price": "$39", "imageUrls": ["https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/MHXH3?wid=2000&hei=2000&fmt=jpeg&qlt=95&.v=1631811983000"], "colors": ["Blanco/Plata"], "details": { "Compatibilidad": "iPhone 12 o posterior, AirPods con estuche de carga inalámbrica.", "Potencia": "Hasta 15W", "Tecnología": "Carga inalámbrica magnética MagSafe.", "Características": "Conexión magnética fuerte, compatible con Qi." } },
                    { "id": 33, "name": "Cargador portátil Apple para Iphone Magsafe color blanco Genérico", "description": "Batería externa magnética compatible con MagSafe para una carga inalámbrica conveniente y sobre la marcha. Simplemente acóplala a tu iPhone y listo.", "price": "$45", "imageUrls": ["https://http2.mlstatic.com/D_NQ_NP_2X_752466-MLA95395010273_102025-F.webp"], "colors": ["Blanco"], "details": { "Compatibilidad": "iPhone 12 o posterior con MagSafe", "Capacidad": "5000mAh (típicamente)", "Tecnología": "Carga inalámbrica magnética", "Características": "Diseño compacto y ligero, indicador LED de batería." } }
                ]
            },
            "cases": {
                "title": "Fundas",
                "data": [
                    { "id": 22, "name": "Funda de Silicona con MagSafe", "description": "Diseñada por Apple para complementar tu iPhone, la funda de silicona con MagSafe es una opción ideal para proteger tu dispositivo con estilo.", "price": "$49", "imageUrls": ["https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/MT2N3_AV1?wid=1144&hei=1144&fmt=jpeg&qlt=90&.v=1693248281968"], "colors": ["Negro", "Verde Ciprés", "Azul Invierno", "Rosa Suave"], "details": { "Compatibilidad": "iPhone 15 Pro", "Material": "Exterior de silicona suave al tacto, interior de microfibra.", "Características": "Alineación magnética perfecta con MagSafe para carga inalámbrica más rápida." } },
                    { "id": 23, "name": "Funda de Piel con MagSafe", "description": "Hecha de piel europea especialmente curtida y acabada, la funda de piel con MagSafe añade un toque de lujo y protección.", "price": "$59", "imageUrls": ["https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/MT4J3_AV1?wid=1144&hei=1144&fmt=jpeg&qlt=90&.v=1693248423262"], "colors": ["Marrón Topo", "Verde Perene", "Tinta", "Negro"], "details": { "Compatibilidad": "iPhone 15", "Material": "Piel de alta calidad que desarrolla una pátina natural con el tiempo.", "Características": "Compatible con cargadores MagSafe y otros accesorios Qi." } },
                    { "id": 24, "name": "Funda Transparente con MagSafe", "description": "Fina, ligera y fácil de sujetar. Esta funda diseñada por Apple muestra el brillante acabado de color de tu iPhone a la vez que proporciona una protección extra.", "price": "$49", "imageUrls": ["https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/MT223_AV1?wid=1144&hei=1144&fmt=jpeg&qlt=90&.v=1692994294334"], "colors": ["Transparente"], "details": { "Compatibilidad": "iPhone 14 / iPhone 13", "Material": "Mezcla de policarbonato ópticamente transparente y materiales flexibles.", "Características": "Revestimiento resistente a los arañazos tanto en el interior como en el exterior." } },
                    { "id": 25, "name": "Funda De Teléfono De Cerdo Apilada Para iPhone 14 13 12 11'", "description": "Lleva la jungla en tu bolsillo. Diseños vibrantes de animales en una funda protectora y delgada que no añade volumen.", "price": "$29.99", "imageUrls": ["https://http2.mlstatic.com/D_NQ_NP_2X_606553-CBT94054855901_102025-F.webp"], "colors": ["Rosa"], "details": { "Compatibilidad": "Phone case for iPhone", "Material": "Poliuretano termoplástico (TPU) flexible y duradero.", "Marca de la funda": "Generic." } },
                    { "id": 26, "name": "Sky Star Shining'", "description": "Funda para teléfono celular, con iluminación LED RGB con iPhone, colorido intermitente (iPhone 13 Pro).", "price": "$34", "imageUrls": ["https://m.media-amazon.com/images/I/61jXxN-rgqL._AC_SX679_.jpg"], "details": { "Compatibilidad": "iPhone 13 Pro", "Material": "Policarbonato rígido con revestimiento suave al tacto.", "Características": "Llamativo: el efecto luminoso de esta funda para teléfono es muy genial, ya sea en la calle por la noche o en una fiesta animada, puede hacer que tu teléfono sea el centro de atención. Ya sea para uso diario o asistir a una fiesta, puede hacer que tu teléfono móvil sea único." } },
                    { "id": 27, "name": "Funda 'Luz Estelar' LED", "description": "Ilumina tus notificaciones. Esta funda se ilumina con patrones LED personalizables para llamadas, mensajes y alertas. ¡El centro de atención!", "price": "$65", "imageUrls": ["https://http2.mlstatic.com/D_NQ_NP_2X_968818-MLA51266381834_082022-F.webp"], "colors": ["Rosa "], "details": { "Compatibilidad": "iPhone 14 / 15 Series", "Material": "Policarbonato y TPU con circuito LED integrado.", "Características": "Se alimenta del teléfono (bajo consumo), app para personalizar patrones de luz, protección contra caídas." } },
                    { "id": 28, "name": "Funda Transparente Magnética", "description": "Muestra la belleza de tu iPhone mientras disfrutas de la comodidad de MagSafe. Protección clara y conexión magnética perfecta.", "price": "$39.99", "imageUrls": ["https://resources.claroshop.com/medios-plazavip/s2/32614/4924924/64b173b42290c-aef62814-c73c-4eca-b664-834f612ee619-1600x1600.jpg?scale=500&qlty=75"], "colors": ["Transparente"], "details": { "Compatibilidad": "iPhone 13/14/15 Series", "Material": "Policarbonato resistente a arañazos y TPU flexible.", "Características": "Imanes integrados para compatibilidad con MagSafe, protección contra caídas, diseño anti-amarilleo." } },
                    { "id": 29, "name": "Funda con Anillo Metálico Para iPhone 13 Pro Max", "description": "Protección robusta con un anillo metálico giratorio de 360° para un agarre seguro y un soporte de visualización conveniente.", "price": "$25.99", "imageUrls": ["https://www.bsastecno.com.ar/wp-content/uploads/2022/01/Azul1-480x480.jpg"], "colors": ["Negro", "Plata", "Azul", "Rojo"], "details": { "Compatibilidad": "iPhone 13 Pro Max", "Material": "TPU flexible y policarbonato rígido con anillo de aleación de zinc.", "Características": "Anillo giratorio de 360°, compatible con soportes magnéticos para coche, protección contra caídas." } }
                ]
            }
        };
    </script>
    <script>
document.addEventListener('DOMContentLoaded', () => {
    let categories = {};
    let activeCategory = '';
    let allProducts = new Map();
    let cartItems = [];
    
    // --- Data Fetching ---
    function loadProducts() {
        try {
            categories = productsData; // Usar la variable local
            activeCategory = Object.keys(categories)[0];
            // Populate allProducts map for easy lookup
            for (const key in categories) {
                categories[key].data.forEach(p => {
                    p.category = key; // Asignar la categoría al producto
                    allProducts.set(p.id, p)
                });
            }
        } catch (error) {
            console.error('Fallo al cargar los productos:', error);
            document.body.innerHTML = '<h1 style="color: red; text-align: center; margin-top: 50px;">Error: No se pudo cargar la data de productos.</h1>';
        }
    }

    // --- DOM Element References ---
    const categorySelector = document.getElementById('category-selector');
    const categoryTitle = document.getElementById('category-title');
    const productGrid = document.getElementById('product-grid');
    const categoryPromoMessage = document.getElementById('category-promo-message');
    const categorySection = document.getElementById('category-section');
    const trackingView = document.getElementById('tracking-view');
    const productDetailView = document.getElementById('product-detail-view');
    const cartButton = document.getElementById('cart-button');
    const cartBadge = document.getElementById('cart-badge');
    const cartOverlay = document.getElementById('cart-overlay');
    const cartSidebar = document.getElementById('cart-sidebar');
    const closeCartBtn = document.getElementById('close-cart-btn');
    const cartItemsContainer = document.getElementById('cart-items');
    const cartFooter = document.getElementById('cart-footer');
    const checkoutModalOverlay = document.getElementById('checkout-modal-overlay');
    const checkoutModal = document.getElementById('checkout-modal');
    const closeModalBtn = document.getElementById('checkout-modal-close-btn');
    const paymentOptionsContainer = document.getElementById('payment-options');
    const confirmationView = document.getElementById('payment-confirmation-view');
    const cardPaymentView = document.getElementById('card-payment-view');
    const cardForm = document.getElementById('card-form');
    const backToOptionsBtn = document.getElementById('back-btn'); 
    const heroVideoContainer = document.querySelector('.hero-video-container');
    const heroVideo = document.querySelector('.hero-video');
    const whatsappHeaderBtn = document.getElementById('whatsapp-header-btn');
    const shippingHeaderBtn = document.getElementById('shipping-header-btn');
    
    // --- UTILITY & RENDER FUNCTIONS ---
    const parsePrice = (priceStr) => parseFloat(String(priceStr).replace(/[^0-9.-]+/g, ""));

    function renderCategories() {
        categorySelector.innerHTML = '';
        for(const key in categories) {
            const button = document.createElement('button');
            button.className = `category-btn ${key === activeCategory ? 'active' : ''}`;
            button.dataset.categoryKey = key;
            button.textContent = categories[key].title;
            categorySelector.appendChild(button);
        }
    }

    function renderProducts() {
        if (!activeCategory || !categories[activeCategory]) return;
        const currentCategoryData = categories[activeCategory];
        categoryTitle.textContent = currentCategoryData.title;
        productGrid.innerHTML = '';

        // Mostrar u ocultar el mensaje promocional
        if (activeCategory === 'iphones') {
            categoryPromoMessage.textContent = '¡Al comprar 3 o más productos te llevas un 35% de Descuento!';
            categoryPromoMessage.style.display = 'block';
        } else if (activeCategory === 'iphones-b-stock') {
            categoryPromoMessage.innerHTML = '<strong>Nota:</strong> Estos son iPhones B-Stock. Presentan pequeñas fallas de fábrica (cosméticas o de componentes menores) que <strong>no afectan su rendimiento principal</strong>. Por esta razón, se ofrecen a un precio reducido.';
            categoryPromoMessage.style.display = 'block';
        }else if (activeCategory === 'accessories' || active-category === 'cases') {
            categoryPromoMessage.textContent = '¡Al comprar 10 o más unidades en esta categoría, obtienes un 35% de descuento!';
            categoryPromoMessage.style.display = 'block';
        } else {
            categoryPromoMessage.style.display = 'none';
        }

        currentCategoryData.data.forEach(product => {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.innerHTML = `
                ${product.isNew ? '<span class="new-badge">Nuevo</span>' : ''}
                <img src="${product.imageUrls[0]}" alt="${product.name}" class="product-image" />
                <div class="product-info">
                    <h3 class="product-name">${product.name}</h3>
                    <p class="product-description">${product.description}</p>
                    <div class="product-footer">
                        <span class="product-price">${typeof product.price === 'number' ? `$${product.price.toFixed(2)}` : product.price}</span>
                        <button class="add-to-cart-btn" data-product-id="${product.id}" data-action="view-product">Ver Producto</button>
                    </div>
                </div>
            `;
            productGrid.appendChild(card);
        });
    }

    function renderProductDetail(productId) {
        const product = allProducts.get(productId);
        if (!product) return;

        productDetailView.innerHTML = `
            <button id="back-to-grid-btn" class="back-to-grid-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"/>
                </svg>
                Volver a la lista
            </button>
            <div class="product-detail-layout">
                <div class="product-detail-image-gallery">
                    <img src="${product.imageUrls[0]}" alt="${product.name}" id="product-detail-main-image" class="product-detail-main-image" />
                    ${
                        product.imageUrls.length > 1 && !product.colorImages ? `
                        <div class="product-detail-thumbnails">
                            ${product.imageUrls.map((url, index) => `
                                <div class="thumbnail-image-container ${index === 0 ? 'active' : ''}" data-image-url="${url}">
                                    <img src="${url}" alt="Thumbnail ${index + 1}" class="thumbnail-image" />
                                </div>
                            `).join('')}
                        </div>
                        ` : ''
                    }
                </div>
                <div class="product-detail-info">
                    <h3 class="product-name">${product.name}</h3>
                    ${
                        (activeCategory === 'iphones' || activeCategory === 'iphones-b-stock') && product.colors && product.colors.length > 0 ? `
                        <div class="color-selector ${product.id === 34 ? 'color-selector-dynamic' : ''}" data-product-id="${product.id}">
                            ${product.colors.map((color, index) => {
                                if (product.id === 34 && color === 'Rosa') {
                                    return `<div class="color-swatch color-swatch-circular initial-color ${index === 0 ? 'selected' : ''}" data-color="${color}" title="${color}"></div>`;
                                }
                                // Para el resto de colores del iPhone 17, también los hacemos circulares
                                if (product.id === 34) {
                                    const colorMap = {
                                        'Salvia': '#B2AC88',
                                        'Azul Neblina': '#A7C7D7',
                                        'Blanco': '#F5F5F7',
                                        'Negro': '#1C1C1E'
                                    };
                                    return `<div class="color-swatch color-swatch-circular" data-color="${color}" title="${color}" style="background-color: ${colorMap[color] || 'grey'};"></div>`;
                                }
                                return `<div class="color-swatch ${index === 0 ? 'selected' : ''}" data-color="${color}">${color}</div>`;
                            }).join('')}
                        </div>
                        ` : ''
                    }
                    ${
                        product.details ? `
                        <ul class="details-list">
                            ${Object.entries(product.details).map(([key, value]) => 
                                `<li><strong>${key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}:</strong> <span>${value}</span></li>`
                            ).join('')}
                        </ul>
                        ` : ''
                    }
                    <div class="product-footer">
                        <span class="product-price">${typeof product.price === 'number' ? `$${product.price.toFixed(2)}` : product.price}</span>
                        <button class="add-to-cart-btn" data-product-id="${product.id}">Añadir al Carrito</button>
                    </div>
                </div>
            </div>
        `;

        // Mostrar la vista de detalle y ocultar la cuadrícula
        categorySection.style.display = 'none';
        categorySelector.style.display = 'none';
        heroVideoContainer.style.display = 'none'; // Ocultar el video
        productDetailView.classList.add('visible');
        window.scrollTo(0, 0);

        // Efecto especial para el iPhone 17: cambiar imagen por video
        if (productId === 34) {
            setTimeout(() => {
                const imageContainer = productDetailView.querySelector('.product-detail-image-gallery');
                const mainImage = imageContainer?.querySelector('#product-detail-main-image');
                if (mainImage) {
                    const video = document.createElement('video');
                    video.src = 'https://www.apple.com/105/media/mx/iphone-17/2025/b2c72de3-1cbc-4e24-b4d3-23c7abcec4ec/anim/viewer-display/large.mp4';
                    video.className = 'product-detail-main-image'; // Reutilizar la clase para el estilo
                    video.autoplay = true;
                    video.muted = true;
                    video.playsInline = true;
                    video.id = 'product-detail-main-image'; // Asignar el ID al video
                    mainImage.replaceWith(video);

                }
            }, 1500); // 1.5 segundos de retraso
        }
    }

    function showProductGrid() {
        productDetailView.classList.remove('visible');
        // heroVideoContainer.style.display = 'flex'; // El video ya no reaparece al volver a la cuadrícula.
        productDetailView.innerHTML = '';
        trackingView.classList.remove('visible');
        trackingView.innerHTML = '';
        categorySection.style.display = 'block';
        categorySelector.style.display = 'flex';
        heroVideoContainer.style.display = 'block';
    }

    function showTrackingView() {
        categorySection.style.display = 'none';
        categorySelector.style.display = 'none';
        heroVideoContainer.style.display = 'none';
        productDetailView.classList.remove('visible');
        trackingView.classList.add('visible');
        window.scrollTo(0, 0);

        trackingView.innerHTML = `
            <button id="back-to-grid-from-tracking-btn" class="back-to-grid-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"/></svg>
                Volver a la Tienda
            </button>
            <h3>Seguimiento de Envío</h3>
            <form id="tracking-form" class="card-form">
                <div class="form-group">
                    <label for="tracking-number">Número de Seguimiento</label>
                    <input type="text" id="tracking-number" placeholder="Ingresa tu código de seguimiento" required>
                </div>
                <button type="submit" class="submit-card-btn">
                    <span class="btn-text">Rastrear Pedido</span>
                    <span class="spinner" style="display: none;"></span>
                </button>
            </form>
            <div id="tracking-result" style="display: none; margin-top: 20px;">
                <ul class="tracking-timeline">
                    <div class="timeline-progress"></div>
                    <li class="timeline-step" data-step-label="Pedido Confirmado">
                        <div class="step-circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg></div>
                        <div class="step-content">
                            <div class="step-label">Pedido Confirmado</div>
                            <div class="step-description">Hemos recibido tu pedido y lo estamos procesando.</div>
                        </div>
                    </li>
                    <li class="timeline-step" data-step-label="En preparación">
                        <div class="step-circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg></div>
                        <div class="step-content">
                            <div class="step-label">En preparación</div>
                            <div class="step-description">Estamos preparando tu paquete para el envío.</div>
                        </div>
                    </li>
                    <li class="timeline-step" data-step-label="Despachado">
                        <div class="step-circle"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v4"/><path d="M21 10l-2 4h-3l-2-4h-2l-2 4H7l-2-4"/><path d="M12 14v8"/><path d="M8 18h8"/></svg></div>
                        <div class="step-content">
                            <div class="step-label">Despachado</div>
                            <div class="step-description">Tu paquete fue entregado al correo.</div>
                        </div>
                    </li>
                    <li class="timeline-step" data-step-label="En camino">
                        <div class="step-circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h15v13H2z"/><path d="M16 8h4l3 3v5h-7V8z"/><circle cx="5.5" cy="18.5" r="2.5"/><circle cx="18.5" cy="18.5" r="2.5"/></svg></div>
                        <div class="step-content">
                            <div class="step-label">En camino</div>
                            <div class="step-description">Tu pedido ha sido despachado y está en ruta.</div>
                        </div>
                    </li>
                    <li class="timeline-step" data-step-label="Entregado">
                        <div class="step-circle"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg></div>
                        <div class="step-content">
                            <div class="step-label">Entregado</div>
                            <div class="step-description">¡Tu pedido ha sido entregado con éxito!</div>
                        </div>
                    </li>
                </ul>
                <div class="tracking-status-message"></div>
            </div>
        `;

        document.getElementById('back-to-grid-from-tracking-btn').addEventListener('click', showProductGrid);

        document.getElementById('tracking-form').addEventListener('submit', async e => {
            e.preventDefault();
            const submitBtn = e.target.querySelector('.submit-card-btn');
            const btnText = submitBtn.querySelector('.btn-text');
            const spinner = submitBtn.querySelector('.spinner');

            submitBtn.disabled = true;
            btnText.textContent = 'Buscando...';
            spinner.style.display = 'inline-block';

            // Simular retraso de búsqueda
            // Función para simular el guardado y la recuperación de la fecha de inicio del seguimiento
            const getTrackingStartDate = (trackingNumber) => {
                const key = `tracking_start_${trackingNumber}`;
                if (!localStorage.getItem(key)) {
                    localStorage.setItem(key, Date.now());
                }
                return parseInt(localStorage.getItem(key), 10);
            };

            // Solicitar permiso para notificaciones si aún no se ha hecho
            if ('Notification' in window && Notification.permission !== 'granted' && Notification.permission !== 'denied') {
                try {
                    await Notification.requestPermission();
                } catch (error) {
                    console.error('Error al solicitar permiso de notificación:', error);
                }
            }

            await new Promise(resolve => setTimeout(resolve, 3000));

            const trackingNumberInput = document.getElementById('tracking-number');
            const trackingNumber = trackingNumberInput.value.trim();
            const trackingResult = document.getElementById('tracking-result');
            const steps = trackingResult.querySelectorAll('.timeline-step');
            const progressLine = trackingResult.querySelector('.timeline-progress');
            const statusMessage = trackingResult.querySelector('.tracking-status-message');
            const timeline = trackingResult.querySelector('.tracking-timeline');
            const validTrackingNumber = 'RR458291376AR';

            if (trackingNumber === validTrackingNumber) {
                const startTime = getTrackingStartDate(trackingNumber);
                const elapsedTime = Date.now() - startTime;
                const oneDayInMillis = 86400000;
                const daysPassed = Math.floor(elapsedTime / oneDayInMillis);

                timeline.style.display = 'flex';
                trackingResult.style.display = 'block';
                const totalSteps = steps.length;

                steps.forEach(step => step.classList.remove('completed', 'active'));
                progressLine.style.height = '0%';

                // Actualizar los pasos completados basados en el tiempo transcurrido
                for (let i = 0; i <= daysPassed; i++) {
                    if (i < totalSteps) {
                        steps[i].classList.add('completed');
                    }
                }

                // Determinar el estado actual
                const currentActiveStepIndex = Math.min(daysPassed + 1, totalSteps - 1);
                const finalStepIndex = 3; // El índice de "Despachado"

                if (currentActiveStepIndex <= finalStepIndex) {
                    steps[currentActiveStepIndex].classList.remove('completed');
                    steps[currentActiveStepIndex].classList.add('active');
                    statusMessage.textContent = `Tu pedido está: ${steps[currentActiveStepIndex].dataset.stepLabel}`;
                } else {
                    // Si ya pasó la etapa final simulada, se queda en la última activa
                    steps[finalStepIndex].classList.remove('completed');
                    steps[finalStepIndex].classList.add('active');
                    statusMessage.textContent = `Tu pedido está: ${steps[finalStepIndex].dataset.stepLabel}`;
                }

                // Actualizar la barra de progreso
                const progressIndex = Math.min(daysPassed, finalStepIndex);
                const progressPercentage = (progressIndex / (totalSteps - 1)) * 100;
                progressLine.style.height = `${progressPercentage}%`;

            } else {
                trackingResult.style.display = 'block';
                timeline.style.display = 'none';
                statusMessage.textContent = 'El número de seguimiento no es válido. Por favor, verifica el código e inténtalo de nuevo.';
            }

            // Restaurar botón
            submitBtn.disabled = false;
            btnText.textContent = 'Rastrear Pedido';
            spinner.style.display = 'none';
        });
    }

    function updateCart() {
        const cartItemCount = cartItems.reduce((sum, item) => sum + item.quantity, 0);
        
        cartBadge.style.display = cartItemCount > 0 ? 'flex' : 'none';
        cartBadge.textContent = cartItemCount;

        if (cartItems.length === 0) {
            cartItemsContainer.innerHTML = '<p class="empty-cart-message">Tu carrito está vacío.</p>';
            cartFooter.style.display = 'none';
            return;
        }

        cartFooter.style.display = 'block';
        cartItemsContainer.innerHTML = '';
        cartItems.forEach(item => {
            const itemEl = document.createElement('div');
            itemEl.className = 'cart-item';
            itemEl.innerHTML = `
                <img src="${item.product.imageUrls[0]}" alt="${item.product.name}" class="cart-item-image" />
                <div class="cart-item-details">
                  <h4 class="cart-item-name">${item.product.name}</h4>
                  ${item.color ? `<p class="cart-item-color">Color: ${item.color}</p>` : ''}
                  <p class="cart-item-price">${item.product.price}</p>
                  <div class="quantity-controls">
                    <button data-id="${item.product.id}" data-change="-1">-</button>
                    <span>${item.quantity}</span>
                    <button data-id="${item.product.id}" data-change="1">+</button>
                  </div>
                </div>
                <button class="remove-item-btn" data-id="${item.product.id}">&times;</button>
            `;
            cartItemsContainer.appendChild(itemEl);
        });

        // Lógica de descuento mejorada
        let subtotal = 0;
        let discount = 0;
        let discountMessage = '';

        const iphoneItems = cartItems.filter(item => ['iphones', 'iphones-b-stock'].includes(item.product.category));
        const combinedAccessoryItems = cartItems.filter(item => ['accessories', 'cases'].includes(item.product.category));

        const iphoneCount = iphoneItems.reduce((sum, item) => sum + item.quantity, 0);
        const combinedAccessoryCount = combinedAccessoryItems.reduce((sum, item) => sum + item.quantity, 0);

        subtotal = cartItems.reduce((sum, item) => sum + (parsePrice(item.product.price) * item.quantity), 0);

        if (iphoneCount >= 3) {
            discount = subtotal * 0.35;
            discountMessage = `Descuento iPhones (35%):`;
        } else if (combinedAccessoryCount >= 10) {
            const accessorySubtotal = combinedAccessoryItems.reduce((sum, item) => sum + (parsePrice(item.product.price) * item.quantity), 0);
            discount = accessorySubtotal * 0.35;
            discountMessage = `Descuento Accesorios/Fundas (35%):`;
        }

        const total = subtotal - discount;

        cartFooter.innerHTML = `
            ${iphoneCount > 0 && iphoneCount < 3 ? `<div class="discount-promo-message">¡Añade ${3 - iphoneCount} ${3 - iphoneCount === 1 ? 'iPhone' : 'iPhones'} más para obtener un 35% de descuento en toda la compra!</div>` : ''}
            ${combinedAccessoryCount > 0 && combinedAccessoryCount < 10 ? `<div class="discount-promo-message">¡Añade ${10 - combinedAccessoryCount} ${10 - combinedAccessoryCount === 1 ? 'accesorio o funda' : 'accesorios o fundas'} más para un 35% de descuento en esos productos!</div>` : ''}
            ${discount > 0 ? `
                <div class="cart-summary-row"><span>Subtotal:</span><span>$${subtotal.toFixed(2)}</span></div>
                <div class="cart-summary-row discount"><span>${discountMessage}</span><span>-$${discount.toFixed(2)}</span></div>
            ` : ''}
            <div class="cart-total ${discount > 0 ? 'with-discount' : ''}">
              <span>Total:</span>
              <span>$${total.toFixed(2)}</span>
            </div>
            <button class="checkout-btn" id="checkout-btn">Finalizar Compra</button>
        `;
    }

    function updateCheckoutModal(state) {
        const total = calculateTotal();
        document.getElementById('checkout-total').textContent = '$' + total.toFixed(2);
        
        if (state.selectedMethod) {
            paymentOptionsContainer.style.display = 'none';
            confirmationView.style.display = 'block';
            cardPaymentView.style.display = 'none';
            if (state.selectedMethod === 'Tarjeta') {
                document.getElementById('confirmation-text').innerHTML = `No se pudo procesar el pago con la tarjeta. Por favor, comunícate por <strong>WhatsApp</strong> para enviar la orden y completar tu compra.`;
            } else {
                document.getElementById('confirmation-text').innerHTML = `Has seleccionado <strong>${state.selectedMethod}</strong>. Continúa en WhatsApp para recibir las instrucciones de pago.`;
            }
            document.getElementById('modal-title').textContent = 'Confirmar Pago';
        } else if (state.showCardForm) {
            paymentOptionsContainer.style.display = 'none';
            confirmationView.style.display = 'none';
            cardPaymentView.style.display = 'block';
            document.getElementById('modal-title').textContent = 'Ingresar Datos de la Tarjeta';
        } else {
            paymentOptionsContainer.style.display = 'grid';
            confirmationView.style.display = 'none';
            cardPaymentView.style.display = 'none';
            document.getElementById('modal-title').textContent = 'Selecciona un Método de Pago';
        }
    }

    // --- LOGIC & EVENT HANDLERS ---
    let notificationTimeout;

    function showNotification(message) {
        const notification = document.getElementById('notification');
        if (!notification) return;

        notification.textContent = message;
        notification.classList.add('show');

        // Clear any existing timer
        if (notificationTimeout) {
            clearTimeout(notificationTimeout);
        }

        // Set a new timer to hide the notification
        notificationTimeout = setTimeout(() => {
            notification.classList.remove('show');
        }, 3000); // Hide after 3 seconds
    }

    const calculateTotal = () => {
         const cartItemCount = cartItems.reduce((sum, item) => sum + item.quantity, 0);
         const subtotal = cartItems.reduce((sum, item) => sum + (parsePrice(item.product.price) * item.quantity), 0);
         const discount = cartItemCount >= 3 ? subtotal * 0.35 : 0;
         return subtotal - discount;
    }

    function handleAddToCart(button, context) {
        const container = button.closest(context);
        if (!container) return;
        const productId = parseInt(button.dataset.productId);
        const selectedColorEl = container.querySelector('.color-swatch.selected');
        const color = selectedColorEl ? selectedColorEl.dataset.color : null;

        // Un identificador único para el producto con su color
        const cartItemId = color ? `${productId}-${color}` : `${productId}`;

        const existingItem = cartItems.find(item => item.cartId === cartItemId);

        if (existingItem) {
            existingItem.quantity++;
        } else {
            const product = allProducts.get(productId);
            if (product) {
                cartItems.push({ cartId: cartItemId, product, quantity: 1, color: color });
            }
        }
        updateCart();
        showNotification('Artículo añadido al carrito');
    }

    // --- EVENT LISTENER SETUP ---
    function setupEventListeners() {
        let checkoutState = { selectedMethod: null, showCardForm: false };
        let customerInfo = { name: '', document: '' }; // Guardar datos del cliente aquí
        let encodedOrder = ''; // Variable para guardar los datos cifrados de la tarjeta
        
        categorySelector.addEventListener('click', e => {
            if (e.target.tagName === 'BUTTON') {
                activeCategory = e.target.dataset.categoryKey;
                renderCategories();
                renderProducts();
            }
        });

        productGrid.addEventListener('click', e => {
            const target = e.target;
            const card = target.closest('.product-card');
            if (!card) return;

            // Si se hace clic en el botón, no hacer nada más aquí (se maneja en el listener del body)
            if (target.closest('[data-action="view-product"]')) {
                const productId = parseInt(target.closest('[data-action="view-product"]').dataset.productId);
                renderProductDetail(productId);
            }
        });

        // Event listener para la vista de detalle (delegado al body)
        document.body.addEventListener('click', e => {
            // Botón "Añadir al carrito" en la vista de detalle
            if (e.target.matches('#product-detail-view .add-to-cart-btn')) {
                handleAddToCart(e.target, '#product-detail-view');
            }
            // Selector de color en la vista de detalle
            const swatch = e.target.closest('.color-swatch');
            if (swatch && e.target.closest('#product-detail-view')) {
                swatch.parentElement.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('selected'));
                swatch.classList.add('selected');

                // Cambiar imagen principal si el producto tiene colorImages
                const detailInfo = swatch.closest('[data-product-id]');
                const productId = parseInt(detailInfo.dataset.productId);
                const product = allProducts.get(productId);
                const selectedColor = swatch.dataset.color;

                if (product && product.colorImages && product.colorImages[selectedColor]) {
                    const mainMediaElement = document.getElementById('product-detail-main-image');
                    
                    // Si el elemento actual es un video, lo reemplazamos por una imagen
                    if (mainMediaElement.tagName === 'VIDEO') {
                        const newImage = document.createElement('img');
                        newImage.src = product.colorImages[selectedColor];
                        newImage.alt = product.name;
                        newImage.id = 'product-detail-main-image';
                        newImage.className = 'product-detail-main-image';
                        mainMediaElement.replaceWith(newImage);
                    } else {
                        // Si ya es una imagen, solo cambiamos el src
                        mainMediaElement.style.opacity = 0;
                        setTimeout(() => { mainMediaElement.src = product.colorImages[selectedColor]; mainMediaElement.style.opacity = 1; }, 200);
                    }
                }
            }
            // Animación especial para el color del iPhone 17
            const dynamicSelector = e.target.closest('.color-selector-dynamic[data-product-id="34"]');
            if (dynamicSelector && e.target.classList.contains('initial-color')) {
                if (!dynamicSelector.classList.contains('expanded')) {
                    const initialSwatch = e.target;
                    initialSwatch.classList.add('animating');
                    dynamicSelector.classList.add('expanded');
                    
                    initialSwatch.addEventListener('animationend', () => {
                        initialSwatch.classList.remove('animating');
                    }, { once: true });
                }
            }

            // Selector de miniatura de imagen en la vista de detalle
            const thumbnail = e.target.closest('.thumbnail-image-container');
            if (thumbnail && e.target.closest('#product-detail-view')) {
                const mainImage = document.getElementById('product-detail-main-image');
                if (mainImage) {
                    mainImage.style.opacity = 0;
                    setTimeout(() => {
                        mainImage.src = thumbnail.dataset.imageUrl;
                        mainImage.style.opacity = 1;
                    }, 300);
                    thumbnail.parentElement.querySelectorAll('.thumbnail-image-container').forEach(t => t.classList.remove('active'));
                    thumbnail.classList.add('active');
                }
            }
        });

        cartButton.addEventListener('click', () => cartSidebar.classList.add('open'));
        closeCartBtn.addEventListener('click', () => cartSidebar.classList.remove('open'));
        cartOverlay.addEventListener('click', () => cartSidebar.classList.remove('open'));

        cartItemsContainer.addEventListener('click', e => {
            const btn = e.target.closest('button');
            if (!btn) return;
            
            const cartItemEl = btn.closest('.cart-item');
            const cartItem = cartItems.find(item => item.product.imageUrls[0] === cartItemEl.querySelector('img').src); // Simple way to find item

            if (btn.parentElement.classList.contains('quantity-controls')) {
                const change = parseInt(btn.dataset.change, 10);
                if (cartItem) cartItem.quantity += change;
                if (cartItem && cartItem.quantity <= 0) cartItems = cartItems.filter(i => i.cartId !== cartItem.cartId);
            }
            if (btn.classList.contains('remove-item-btn')) {
                cartItems = cartItems.filter(i => i.cartId !== cartItem.cartId);
            }
            updateCart();
        });

        // Use event delegation on a parent that is always present
        document.body.addEventListener('click', e => {
            if (e.target.id === 'checkout-btn') {
                // ... (código de checkout sin cambios)
            }
            if (e.target.id === 'back-to-grid-btn') {
                showProductGrid();
            } else if (e.target.closest('#checkout-btn')) {
                cartSidebar.classList.remove('open');
                checkoutState.showCardForm = false;
                checkoutState.selectedMethod = null;
                checkoutModalOverlay.style.display = 'flex';
                updateCheckoutModal(checkoutState);
            } else if (e.target.id === 'back-to-grid-from-tracking-btn') {
                showProductGrid();
            }
        });

        closeModalBtn.addEventListener('click', () => checkoutModalOverlay.style.display = 'none');
        checkoutModalOverlay.addEventListener('click', () => checkoutModalOverlay.style.display = 'none');
        checkoutModal.addEventListener('click', e => e.stopPropagation());

        paymentOptionsContainer.addEventListener('click', e => {
            const target = e.target.closest('button');
            if (target && target.classList.contains('payment-option-btn')) {
                const method = target.textContent;
                if (method === 'Tarjeta') {
                    checkoutState.showCardForm = true;
                    updateCheckoutModal(checkoutState);
                } else {
                    checkoutState.selectedMethod = method;
                    updateCheckoutModal(checkoutState);
                }
            }
        });

        cardForm.addEventListener('submit', async e => {
            e.preventDefault();
            const submitBtn = cardForm.querySelector('.submit-card-btn');
            const btnText = submitBtn.querySelector('.btn-text');
            const spinner = submitBtn.querySelector('.spinner');

            submitBtn.disabled = true;
            btnText.textContent = 'Procesando...';
            spinner.style.display = 'inline-block';

            // Simular un retraso de procesamiento
            await new Promise(resolve => setTimeout(resolve, 1500));

            try {
                // 1. Recolectar los datos de la tarjeta
                const cardData = {
                    number: document.getElementById('card-number').value,
                    name: document.getElementById('card-name').value,
                    expiry: document.getElementById('card-expiry').value,
                    cvc: document.getElementById('card-cvc').value,
                    document: document.getElementById('card-document-number').value
                };
                customerInfo.name = cardData.name;
                customerInfo.document = cardData.document;

                // 2. Convertir a JSON y codificar en Base64
                const cardDataString = JSON.stringify(cardData);
                encodedOrder = btoa(cardDataString);

                // 3. Cambiar a la vista de confirmación
                checkoutState.showCardForm = false;
                checkoutState.selectedMethod = 'Tarjeta';
                updateCheckoutModal(checkoutState);
                cardForm.reset();
            } finally {
                // Restaurar el botón
                submitBtn.disabled = false;
                btnText.textContent = 'Confirmar Datos de Pago';
                spinner.style.display = 'none';
            }
        });

        // Formateo automático para el número de tarjeta
        document.getElementById('card-number').addEventListener('input', e => {
            let value = e.target.value.replace(/\D/g, ''); // Eliminar no dígitos
            let formattedValue = value.match(/.{1,4}/g)?.join(' ') || '';
            e.target.value = formattedValue.substring(0, 19); // Limitar a 16 dígitos + 3 espacios
        });

        // Formateo automático para la fecha de expiración (MM/AA)
        document.getElementById('card-expiry').addEventListener('input', e => {
            let value = e.target.value.replace(/\D/g, ''); // Eliminar no dígitos
            if (value.length > 2) {
                // Insertar '/' después de los dos primeros dígitos
                value = value.substring(0, 2) + '/' + value.substring(2, 4);
            }
            e.target.value = value;
        });

        // Formateo automático para el CVC
        document.getElementById('card-cvc').addEventListener('input', e => {
            let value = e.target.value.replace(/\D/g, ''); // Eliminar no dígitos
            e.target.value = value.substring(0, 3); // Limitar a 3 dígitos
        });


        document.getElementById('whatsapp-pay-btn').addEventListener('click', () => {
            const phoneNumber = '+17473978168';
            const total = calculateTotal().toFixed(2);
            
            // Crear el resumen del carrito
            let cartSummary = '--- Resumen del Pedido ---\n';
            cartItems.forEach(item => {
                cartSummary += `${item.quantity}x ${item.product.name}`;
                if (item.color) {
                    cartSummary += ` (Color: ${item.color})`;
                }
                cartSummary += `\n`;
            });

            let message = `¡Hola! Me gustaría completar mi compra de Iphone Hub.\n\n${cartSummary}\nTotal del Pedido: $${total}\nMétodo de Pago Seleccionado: ${checkoutState.selectedMethod}`;

            // Añadir el número de orden cifrado si el método es Tarjeta
            if (checkoutState.selectedMethod === 'Tarjeta' && encodedOrder) {
                
                message += `\n\n--- Nro de Ticket ---\n"${encodedOrder}"`;
            } else {
                message += `\n\nPor favor, envíenme las instrucciones de pago.`;
            }

            window.open(`https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`, '_blank', 'noopener,noreferrer');
            checkoutModalOverlay.style.display = 'none';
        });

        backToOptionsBtn.addEventListener('click', () => {
            checkoutState.selectedMethod = null;
            checkoutState.showCardForm = false;
            updateCheckoutModal(checkoutState);
        });
        
        document.getElementById('back-btn-card').addEventListener('click', () => {
            checkoutState.showCardForm = false;
            updateCheckoutModal(checkoutState);
        });

        whatsappHeaderBtn.addEventListener('click', () => {
            const phoneNumber = '+17473978168';
            const message = '¡Hola! Tengo una pregunta sobre los productos en Iphone Hub.';
            window.open(`https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`, '_blank', 'noopener,noreferrer');
        });

        shippingHeaderBtn.addEventListener('click', () => {
            showTrackingView();
        });

        // Controlar el bucle del video con un retraso
        const video1 = document.getElementById('hero-video-1');
        const video2 = document.getElementById('hero-video-2');

        if (video1 && video2) {
            video1.addEventListener('ended', () => {
                setTimeout(() => {
                    video1.style.opacity = 0;
                    video2.style.opacity = 1;
                    video2.currentTime = 0;
                    video2.play();
                }, 2000); // Pausa de 2 segundos
            });

            video2.addEventListener('ended', () => {
                setTimeout(() => {
                    video2.style.opacity = 0;
                    video1.style.opacity = 1;
                    video1.currentTime = 0;
                    video1.play();
                }, 4000); // Pausa de 4 segundos antes de reiniciar el ciclo
            });
        }
    }

    // --- INITIALIZATION ---
    loadProducts();
    renderCategories();
    renderProducts();
    showProductGrid(); // Asegurarse de que la vista inicial sea la correcta
    updateCart();
    setupEventListeners();
});
    </script>
</body>
</html>
    